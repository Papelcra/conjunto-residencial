{% extends "base.html" %}

{% block title %}Estado de Cuenta{% endblock %}

{% block content %}

<div class="container py-4">

    <h2>Estado de Cuenta — Apto {{ apartamento.identificador }}</h2>

    <p class="text-muted">
        Residente:
        {% if apartamento.ocupante_actual %}
            {{ apartamento.ocupante_actual.get_full_name|default:apartamento.ocupante_actual.username }}
        {% else %}
            Sin residente asignado
        {% endif %}
    </p>

    <div class="alert alert-info">
        <strong>Total pagado:</strong> $ {{ total_pagado|floatformat:0 }}
    </div>

    <div class="card shadow-sm">
        <div class="card-header">
            Historial de pagos
        </div>

        <table class="table mb-0">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Monto</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>

            {% for p in pagos %}
                <tr>
                    <td>{{ p.fecha_pago|date:"d/m/Y" }}</td>
                    <td>$ {{ p.monto|floatformat:0 }}</td>
                    <td>
                        {% if p.estado == "aprobado" %}
                            <span class="badge bg-success">Aprobado</span>
                        {% elif p.estado == "pendiente" %}
                            <span class="badge bg-warning">Pendiente</span>
                        {% else %}
                            <span class="badge bg-danger">Rechazado</span>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="3" class="text-center text-muted">
                        No hay pagos registrados.
                    </td>
                </tr>
            {% endfor %}

            </tbody>
        </table>
    </div>

    <a href="{% url 'pagos:estado_pagos' %}" class="btn btn-secondary mt-3">
        ← Volver
    </a>

</div>

{% endblock %}